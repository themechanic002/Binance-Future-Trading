# 📈 Binance Futures Correlation Trader (byeonghyeon.py)

이 프로젝트는 **바이낸스 선물 시장**에서 **비트코인(BTC)**과 **높은 상관관계를 가지는 알트코인**을 분석한 뒤, 해당 코인들을 자동으로 **레버리지 매수**하는 시스템입니다.

---

## 🧠 프로젝트 개요

- 비트코인(BTC/USDT)의 가격 움직임과 높은 상관관계를 가지는 알트코인 10개를 선정합니다.
- 각 코인의 4시간봉 종가(OHLCV)를 기준으로 **상관계수(Pearson)**를 계산합니다.
- 상관계수 상위 코인을 골라 **지정한 레버리지(n배)**로 자동 매수 주문을 실행합니다.
- 바이낸스의 **USDT-M 선물 시장**을 기반으로 작동합니다.

---

## 🛠 기능 요약

| 기능 | 설명 |
|------|------|
| `get_usdt_pairs()` | 바이낸스 선물 USDT-M 마켓에서 거래 가능한 모든 코인 목록 가져오기 |
| `fetch_ohlcv()` | 특정 코인의 4시간봉 가격 데이터(OHLCV) 조회 |
| `get_correlated_coins()` | 비트코인과 상관계수를 계산하여 상위 알트코인 선정 |
| `get_balance()` | 선물 계정의 USDT 잔고 조회 |
| `get_position_mode()` | 포지션 모드(단방향 or 헤지모드) 확인 |
| `place_orders()` | 선정된 코인에 대해 지정가 매수 주문 실행 |
| `main()` | 전체 실행 흐름 제어 (코인 분석 → 잔고 조회 → 주문 실행) |

---

## 📦 사용 방법

1. **필수 패키지 설치**
    ```bash
    pip install ccxt pandas numpy
    pip install python-dotenv
    ```
    (.env 파일에 api key를 저장하는 경우 필요에 따라서 python-dotenv를 설치합니다.)

2. **API 키 입력**
    ```python
    api_key = 'YOUR_BINANCE_API_KEY'
    secret = 'YOUR_BINANCE_SECRET_KEY'
    ```

3. **파라미터 설정**
    - `ORDER_RATIO` : 전체 잔고의 몇 %를 투자할지 (예: 0.9 = 90%)
    - `corr_threshold` : 상관계수 최소 기준 (예: 0.8)
    - `leverage` : 사용할 레버리지 배수 (예: 5)

4. **실행**
    ```bash
    python your_script_name.py
    ```

---

## 📊 작동 방식

1. 바이낸스의 선물 마켓에서 USDT-M 기반 코인 목록을 가져옵니다.
2. 각 코인에 대해 4시간봉 OHLCV 데이터를 불러오고, BTC/USDT와 종가 기준 상관계수를 계산합니다.
3. 상관계수 기준 상위 10개 코인을 필터링하고, 설정된 기준 이상일 경우 매수 대상으로 선정합니다.
4. 잔고에서 설정된 비율만큼 자산을 나누어 각 코인에 투자합니다.
5. 레버리지 설정 후 지정가로 매수 주문을 실행합니다.

---

## ⚠️ 주의사항

- **실제 자금**을 사용하는 코드입니다. 반드시 테스트 후 운영 환경에서 실행하세요.
- 상관계수는 과거 데이터에 기반하며, 미래 수익을 보장하지 않습니다.
- 바이낸스 API 요청에는 **Rate Limit**이 존재하므로 시간 지연(`time.sleep`)이 포함되어 있습니다.
- **헤지모드(Hedge Mode)**에서는 `positionSide: LONG` 옵션이 필수입니다. 설정이 잘못되면 주문이 실패할 수 있습니다.

---

## ✅ 실행 예시

```text
🔧 현재 Hedge 포지션 모드 여부: False
🔍 총 87개 코인과 상관계수 계산 완료.

📊 [상관계수 상위 10 코인]
 1. ETH/USDT       | 상관계수: 0.9321
 2. BNB/USDT       | 상관계수: 0.9104
 ...

💰 USDT 잔고: 235.78 USDT
💰 각 코인 10개에 할당된 금액: 21.200 USDT

💡 ETH/USDT 매도 1호가: 1932.24 USDT
🛒 ETH/USDT 매수 주문 시도 중 (가격: 1932.24, 수량: 0.0549)
✅ 주문 완료: 1234567890
...
📦 매수 완료된 코인:
  - ETH/USDT
  - BNB/USDT
